define("paygw_paymob/admin_form",["exports","jquery","core/ajax"],(function(_exports,_jquery,_ajax){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * TODO describe module admin_form
   *
   * @module     paygw_paymob/admin_form
   * @copyright  2024 Mohammad Farouk <phun.for.physics@gmail.com>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_jquery=_interopRequireDefault(_jquery),_ajax=_interopRequireDefault(_ajax);let ajaxObject=new Object;function showError(msg){(0,_jquery.default)(".paygw-paymob-error").text(msg),(0,_jquery.default)(".paygw-paymob-error").show(),(0,_jquery.default)(".paygw-paymob-error").fadeOut(1e4)}function callAjax(){(0,_jquery.default)(".paygw-paymob-error").text(""),(0,_jquery.default)(".paygw-paymob-error").hide();let publickey=(0,_jquery.default)("#id_public_key").val(),privatekey=(0,_jquery.default)("#id_private_key").val(),legacy=(0,_jquery.default)('input[name="legacy"]').is(":checked");if(legacy&&(publickey="egy",privatekey="egy"),0===(0,_jquery.default)("#id_apikey").val().length||0===publickey.length||0===privatekey.length)showError("Please provide Paymob API, public and secret keys");else if(!legacy&&(publickey.length<20||privatekey.length<20))showError("Please provide correct public and secret keys or choose legacy mode");else{(0,_jquery.default)(".paygw-paymob-loader").css("display","block"),_ajax.default.call([{methodname:"paygw_paymob_get_admin_options",args:{apikey:(0,_jquery.default)("#id_apikey").val(),publickey:publickey,privatekey:privatekey,accountid:(0,_jquery.default)('input[name="accountid"]').val()}}])[0].done((function(data){(0,_jquery.default)('input[name="hmac"]').val(data.hmac),(0,_jquery.default)('input[name="hmac_hidden"]').val(data.hmac);var html="",ids="",allids=[];let integrationIDs=JSON.parse(data.integration_ids);_jquery.default.each(integrationIDs,(function(i,integration){allids.push(integration.id);var text=integration.id+" : "+integration.name+" ("+integration.type+" : "+integration.currency+" )";ids=ids+text+",";let selected="",shouldSelected=function(){let selected=(0,_jquery.default)('input[name="integration_ids"]').val();return selected?JSON.parse(selected):[]}();shouldSelected&&shouldSelected.length>0&&_jquery.default.each(shouldSelected,(function(ii,id){integration.id!==id&&parseInt(integration.id)!==parseInt(id)||(selected="selected")})),""!==text&&(html=html+"<option "+selected+" value="+integration.id+">"+text+"</option>")})),(0,_jquery.default)('input[name="integration_ids_hidden"]').val(ids),html&&(0,_jquery.default)("#id_integration_ids_select").html(html),saveSelected(),(0,_jquery.default)('input[name="integration_ids"]').val(JSON.stringify(allids)),(0,_jquery.default)(".paygw-paymob-loader").fadeOut(10),(0,_jquery.default)(".paygw-paymob-success_load").css("display","block"),(0,_jquery.default)(".paygw-paymob-success_load").fadeOut(500),(0,_jquery.default)("#paygw-paymob-not-valid").css("display","none"),(0,_jquery.default)("#paygw-paymob-valid").css("display","inline-block")})).fail((function(error){(0,_jquery.default)(".paygw-paymob-loader").fadeOut(10),showError(error.message),(0,_jquery.default)(".paygw-paymob-failed_load").css("display","block"),(0,_jquery.default)(".paygw-paymob-failed_load").fadeOut(500),(0,_jquery.default)("#paygw-paymob-not-valid").css("display","inline-block"),(0,_jquery.default)("#paygw-paymob-valid").css("display","none")}))}}function saveSelected(){var selectedOptions=(0,_jquery.default)("#id_integration_ids_select").find("option:selected"),values=_jquery.default.map(selectedOptions,(function(option){return(0,_jquery.default)(option).val()})),valuesString=JSON.stringify(values);(0,_jquery.default)('input[name="integration_ids"]').val(valuesString)}_exports.init=data=>{ajaxObject=JSON.parse(data),(0,_jquery.default)("#cpicon").on("click",(function(){var copyText=document.getElementById("cburl").innerText;navigator&&navigator.clipboard?navigator.clipboard.writeText(copyText):prompt("Copy link, then click OK.",copyText)})),(0,_jquery.default)("#accept-login").on("click",(function(){callAjax()})),(0,_jquery.default)(".paygw-paymob-loader").fadeOut(1500,(function(){(0,_jquery.default)("#id_integration_ids_select").html("");var integrationHidden=ajaxObject.integration_hidden.split(",");(0,_jquery.default)("#id_hmac").val(ajaxObject.hmac_hidden),ajaxObject.integration_hidden.length>0&&_jquery.default.each(integrationHidden,(function(i,avId){var selected="";if(""!==avId){var integrationId=avId.split(" :");_jquery.default.each(ajaxObject.integration_id,(function(i,id){integrationId!==id&&parseInt(integrationId)!==parseInt(id)||(selected="selected")}))}(0,_jquery.default)("#id_integration_ids_select").append("<option "+selected+" value="+avId+">"+avId+"</option>")}))})),(0,_jquery.default)("#id_integration_ids_select").on("change",saveSelected)}}));

//# sourceMappingURL=admin_form.min.js.map