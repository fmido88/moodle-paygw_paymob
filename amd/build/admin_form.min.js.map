{"version":3,"file":"admin_form.min.js","sources":["../src/admin_form.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * TODO describe module admin_form\n *\n * @module     paygw_paymob/admin_form\n * @copyright  2024 Mohammad Farouk <phun.for.physics@gmail.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport $ from 'jquery';\nimport Ajax from 'core/ajax';\n\nlet ajax_object = new Object();\n/**\n * Call ajax request to retrieve required data.\n */\nfunction callAjax() {\n    let publickey = $('#id_public_key').val();\n    let privatekey = $('#id_private_key').val();\n    let legacy = $('input[name=\"legacy\"]').is(':checked');\n    if (legacy) {\n        publickey = 'egy';\n        privatekey = 'egy';\n    }\n\n    if ($('#id_apikey').val().length === 0\n        || publickey.length === 0\n        || privatekey.length === 0) {\n        alert('Please provide Paymob API, public and secret keys');\n    } else if (!legacy && (publickey.length < 20 || privatekey.length < 20)) {\n        alert('Please provide correct public and secret keys or choose legacy mode');\n    } else {\n        $(\".paygw-paymob-loader\").css('display', 'block');\n        let post = Ajax.call([{\n                methodname: \"paygw_paymob_get_admin_options\",\n                args: {\n                    apikey: $('#id_apikey').val(),\n                    publickey: publickey,\n                    privatekey: privatekey,\n                    accountid: $('input[name=\"accountid\"]').val()\n                }\n            }]);\n\n        // console.log(post);\n        post[0].done(function (data) {\n            // console.log(data);\n\n            $('input[name=\"hmac\"]').val(data.hmac);\n            $('input[name=\"hmac_hidden\"]').val(data.hmac);\n            var html = '';\n            var ids  = '';\n            var allids = [];\n            let integrationIDs = JSON.parse(data.integration_ids);\n            $.each(integrationIDs, function (i, integration) {\n                allids.push(integration.id);\n                var text = integration.id + \" : \" + integration.name\n                         + \" (\" + integration.type + \" : \" + integration.currency + \" )\";\n                ids = ids + text + ',';\n                if (ajax_object.integration_id.length > 0) {\n                    var selected = '';\n                    $.each(\n                        ajax_object.integration_id,\n                        function (ii, id) {\n                            if (integration.id === id || parseInt( integration.id ) === parseInt( id )) {\n                                selected = 'selected';\n                            }\n                        }\n                    );\n                }\n\n                if (text !== '') {\n                    html = html + \"<option \" + selected + \" value=\" + integration.id + \">\" + text + \"</option>\";\n                }\n            });\n\n            $('input[name=\"integration_ids_hidden\"]').val(ids);\n\n            if (html) {\n                $('#id_integration_ids_select').html(html);\n            }\n\n            $('input[name=\"integration_ids\"]').val(JSON.stringify(allids));\n\n            $(\".paygw-paymob-loader\").fadeOut(10);\n            $(\".paygw-paymob-success_load\").css('display', 'block');\n            $(\".paygw-paymob-success_load\").fadeOut(500);\n\n            $('#paygw-paymob-not-valid').css('display', 'none');\n            $('#paygw-paymob-valid').css('display', 'inline-block');\n        }).fail(function(error) {\n                // console.log(error);\n                $(\".paygw-paymob-loader\").fadeOut(10);\n                alert(error.message);\n                $(\".paygw-paymob-failed_load\").css('display', 'block');\n                $(\".paygw-paymob-failed_load\").fadeOut(500);\n                $('#paygw-paymob-not-valid').css('display', 'inline-block');\n                $('#paygw-paymob-valid').css('display', 'none');\n            }\n        );\n\n    }\n}\n\nexport const init = ($data) => {\n    ajax_object = JSON.parse($data);\n\n    // console.log(ajax_object);\n    $('#cpicon').on(\"click\", function () {\n            var copyText = document.getElementById('cburl').innerText;\n            if (navigator && navigator.clipboard) {\n                navigator.clipboard.writeText(copyText);\n                alert('Copied!');\n            } else {\n                prompt(\"Copy link, then click OK.\", copyText);\n            }\n        });\n\n    $('#accept-login').on(\"click\", function () {\n        callAjax();\n    });\n\n    $(\".paygw-paymob-loader\").fadeOut(1500, function () {\n        $('#id_integration_ids_select').html('');\n        var integration_hidden = ajax_object.integration_hidden.split(\",\");\n        $('#id_hmac').val(ajax_object.hmac_hidden);\n\n        if (ajax_object.integration_hidden.length > 0) {\n            $.each(integration_hidden, function (av_i, av_id) {\n                var selected = '';\n                if (av_id !== '') {\n                    var integrationId = av_id.split( \" :\" );\n                    $.each(ajax_object.integration_id, function (i, id) {\n                        if (integrationId === id || parseInt(integrationId) === parseInt( id )) {\n                            selected = 'selected';\n                        }\n                    });\n                }\n\n                $('#id_integration_ids_select').append( \"<option \" + selected + \" value=\" + av_id + \">\" + av_id + \"</option>\" );\n            });\n        }\n    });\n    $('#id_integration_ids_select').on('change', function() {\n        var selectedOptions = $(this).find('option:selected');\n\n        var values = $.map(selectedOptions, function(option) {\n            return $(option).val();\n        });\n\n        var valuesString = JSON.stringify(values);\n\n        // Set the value of the input field\n        $('input[name=\"integration_ids\"]').val(valuesString);\n    });\n};\n"],"names":["ajax_object","Object","$data","JSON","parse","on","copyText","document","getElementById","innerText","navigator","clipboard","writeText","alert","prompt","publickey","val","privatekey","legacy","is","length","css","Ajax","call","methodname","args","apikey","accountid","done","data","hmac","html","ids","allids","integrationIDs","integration_ids","each","i","integration","push","id","text","name","type","currency","integration_id","selected","ii","parseInt","stringify","fadeOut","fail","error","message","callAjax","integration_hidden","split","hmac_hidden","av_i","av_id","integrationId","append","selectedOptions","this","find","values","$","map","option","valuesString"],"mappings":"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"}