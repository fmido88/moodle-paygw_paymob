{"version":3,"file":"admin_form.min.js","sources":["../src/admin_form.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * TODO describe module admin_form\n *\n * @module     paygw_paymob/admin_form\n * @copyright  2024 Mohammad Farouk <phun.for.physics@gmail.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport $ from 'jquery';\nimport Ajax from 'core/ajax';\n\nlet ajaxObject = new Object();\n/**\n * Call ajax request to retrieve required data.\n */\nfunction callAjax() {\n    let publickey = $('#id_public_key').val();\n    let privatekey = $('#id_private_key').val();\n    let legacy = $('input[name=\"legacy\"]').is(':checked');\n    if (legacy) {\n        publickey = 'egy';\n        privatekey = 'egy';\n    }\n\n    if ($('#id_apikey').val().length === 0\n        || publickey.length === 0\n        || privatekey.length === 0) {\n        error('Please provide Paymob API, public and secret keys');\n    } else if (!legacy && (publickey.length < 20 || privatekey.length < 20)) {\n        error('Please provide correct public and secret keys or choose legacy mode');\n    } else {\n        $(\".paygw-paymob-loader\").css('display', 'block');\n        let post = Ajax.call([{\n                methodname: \"paygw_paymob_get_admin_options\",\n                args: {\n                    apikey: $('#id_apikey').val(),\n                    publickey: publickey,\n                    privatekey: privatekey,\n                    accountid: $('input[name=\"accountid\"]').val()\n                }\n            }]);\n\n        post[0].done(function(data) {\n\n            $('input[name=\"hmac\"]').val(data.hmac);\n            $('input[name=\"hmac_hidden\"]').val(data.hmac);\n            var html = '';\n            var ids = '';\n            var allids = [];\n            let integrationIDs = JSON.parse(data.integration_ids);\n            $.each(integrationIDs, function(i, integration) {\n                allids.push(integration.id);\n                var text = integration.id + \" : \" + integration.name\n                         + \" (\" + integration.type + \" : \" + integration.currency + \" )\";\n                ids = ids + text + ',';\n                let selected = '';\n                if (ajaxObject.integration_id.length > 0) {\n                    $.each(\n                        ajaxObject.integration_id,\n                        function(ii, id) {\n                            if (integration.id === id || parseInt(integration.id) === parseInt(id)) {\n                                selected = 'selected';\n                            }\n                        }\n                    );\n                }\n\n                if (text !== '') {\n                    html = html + \"<option \" + selected + \" value=\" + integration.id + \">\" + text + \"</option>\";\n                }\n            });\n\n            $('input[name=\"integration_ids_hidden\"]').val(ids);\n\n            if (html) {\n                $('#id_integration_ids_select').html(html);\n            }\n\n            $('input[name=\"integration_ids\"]').val(JSON.stringify(allids));\n\n            $(\".paygw-paymob-loader\").fadeOut(10);\n            $(\".paygw-paymob-success_load\").css('display', 'block');\n            $(\".paygw-paymob-success_load\").fadeOut(500);\n\n            $('#paygw-paymob-not-valid').css('display', 'none');\n            $('#paygw-paymob-valid').css('display', 'inline-block');\n        }).fail(function(error) {\n                $(\".paygw-paymob-loader\").fadeOut(10);\n                error(error.message);\n                $(\".paygw-paymob-failed_load\").css('display', 'block');\n                $(\".paygw-paymob-failed_load\").fadeOut(500);\n                $('#paygw-paymob-not-valid').css('display', 'inline-block');\n                $('#paygw-paymob-valid').css('display', 'none');\n            }\n        );\n\n    }\n}\n\nexport const init = ($data) => {\n    ajaxObject = JSON.parse($data);\n\n    $('#cpicon').on(\"click\", function() {\n            var copyText = document.getElementById('cburl').innerText;\n            if (navigator && navigator.clipboard) {\n                navigator.clipboard.writeText(copyText);\n            } else {\n                // eslint-disable-next-line no-alert\n                prompt(\"Copy link, then click OK.\", copyText);\n            }\n        });\n\n    $('#accept-login').on(\"click\", function() {\n        callAjax();\n    });\n\n    $(\".paygw-paymob-loader\").fadeOut(1500, function() {\n        $('#id_integration_ids_select').html('');\n        var integrationHidden = ajaxObject.integrationHidden.split(\",\");\n        $('#id_hmac').val(ajaxObject.hmac_hidden);\n\n        if (ajaxObject.integrationHidden.length > 0) {\n            $.each(integrationHidden, function(i, avId) {\n                var selected = '';\n                if (avId !== '') {\n                    var integrationId = avId.split(\" :\");\n                    $.each(ajaxObject.integration_id, function(i, id) {\n                        if (integrationId === id || parseInt(integrationId) === parseInt(id)) {\n                            selected = 'selected';\n                        }\n                    });\n                }\n\n                $('#id_integration_ids_select').append(\"<option \" + selected + \" value=\" + avId + \">\" + avId + \"</option>\");\n            });\n        }\n    });\n    $('#id_integration_ids_select').on('change', function() {\n        var selectedOptions = $(this).find('option:selected');\n\n        var values = $.map(selectedOptions, function(option) {\n            return $(option).val();\n        });\n\n        var valuesString = JSON.stringify(values);\n\n        // Set the value of the input field\n        $('input[name=\"integration_ids\"]').val(valuesString);\n    });\n};\n\n/**\n * @param {string} msg\n */\nfunction error(msg) {\n    $('.paygw-paymob-error').html = msg;\n    $('.paygw-paymob-error').show();\n    $('.paygw-paymob-error').fadeOut(3500);\n}\n"],"names":["ajaxObject","Object","error","msg","html","show","fadeOut","$data","JSON","parse","on","copyText","document","getElementById","innerText","navigator","clipboard","writeText","prompt","publickey","val","privatekey","legacy","is","length","css","Ajax","call","methodname","args","apikey","accountid","done","data","hmac","ids","allids","integrationIDs","integration_ids","each","i","integration","push","id","text","name","type","currency","selected","integration_id","ii","parseInt","stringify","fail","message","callAjax","integrationHidden","split","hmac_hidden","avId","integrationId","append","selectedOptions","this","find","values","$","map","option","valuesString"],"mappings":"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"}